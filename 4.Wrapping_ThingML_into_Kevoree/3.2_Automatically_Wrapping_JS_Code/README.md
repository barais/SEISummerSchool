### How to use generated public APIs to integrate with ThingML at the code level (in JavaScript)?

Imagine you have this configuration:

```
configuration Deployment0JS {
    instance timer : TimerJS
}
```

Now if you generate the JS code and run the main, it won't do much: no one is calling the `timer_start` and no one is listening for the `timer_timeout` message.

We have seen in Tutorial 1 how Java (or JS, or C) code can be mixed with ThingML models. We will now see how we can integrate legacy/third-party code with ThingML,
directly at the code level using the public APIs generated by ThingML.

The generated code has the following structure:

```
Connector.js      #Utilities for ThingML connectors
main.js           #the file to run, instantiating things and connectors
package.json      #defines dependencies, etc needed for npm install
state-factory     #Utilities for instantiating the state machine, etc
TimerJS.js        #the generated code for the timer
```

Looking in more details at `main.js`:

```javascript
var Connector = require('./Connector');
var TimerJS = require('./TimerJS');
process.stdin.resume();//to keep Node.js alive even when it is nothing more to do...

var Deployment0JS_timer = new TimerJS();
Deployment0JS_timer.setThis(Deployment0JS_timer);

Deployment0JS_timer._init();

//terminate all things on SIGINT (e.g. CTRL+C)
process.on('SIGINT', function() {
console.log("Stopping components... CTRL+D to force shutdown");
Deployment0JS_timer._stop();
});
```

> The generated JS code has a fairly similar structure than the generated Java code.



Again, this main is pretty useless as it only instantiate a timer that no one uses.

However, you can register a listener on the timer (after it has been instantiated, and ideally before it has been started)
so that you can get notified when the timer emits a timeout:

```javascript
Deployment0JS_timer.getTimerListeners().push(function(msg){console.log(msg);});
```

> Note that we directly instantiate the interface defined in the API package and provide its implementation (anonymous classe).
You can of course define your own class that implements this interface.

Well... listening to the timeout will not really help, until you call the timer_start (after the thing instance has been started):

```javascript
Deployment0JS_timer.receivetimer_startOntimer(2000);
```

After two seconds, you should see a timeout message in the console.


### How to use the automatic ThingML-to-Kevoree/JS transformation?

Easy, just generate the standard JS behavior (as you have seen in Tutorial 1) and then call the ThingML-to-Kevoree/JS compiler: `ThingML (Deprecated) --> Compile JS Kevoree`.

> This will generate all you need. No need to call `yo kevoree`. Actually, **do not call `yo kevoree`** as this will erase/corrupt the files generated by the ThingML compiler.

Just execute `npm install` to download and install all required libraries and you are ready to go! For example run `grunt kevoree` to deploy the generated KevScript (which you might need to complement beforehand with some channels and bindings)!